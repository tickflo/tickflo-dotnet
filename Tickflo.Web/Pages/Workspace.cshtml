@page "/workspaces/{slug?}"
@model Tickflo.Web.Pages.WorkspaceModel
@{
    ViewData["Title"] = Model.Workspace?.Name ?? "Workspaces";
}

<div class="flex">
    <aside class="sticky top-0 h-screen w-60 overflow-y-auto bg-base-200 px-4 py-6" aria-labelledby="workspace-nav">
        <nav id="workspace-nav" aria-label="Workspace navigation">
        @* Top workspace quick link (first workspace if present) *@
            @if (Model.Workspaces.Any())
        {
            var top = Model.Workspaces.First();
            <a class="btn btn-ghost" asp-page="/Workspace" asp-route-slug="@top.Slug">@top.Name</a>
        }
        else
        {
            <a class="btn btn-ghost" asp-page="/Workspace">Workspaces</a>
        }

        <ul class="menu w-56 rounded-box bg-base-200">
            <li><a class="menu-active" asp-page="/Workspace"><i class="fa fa-house"></i> Dashboard</a></li>
            <li><a href="/workspaces/contacts"><i class="fa fa-address-book"></i> Contacts</a></li>
            <li>
                <details open>
                    <summary><i class="fa fa-ticket-simple"></i> Tickets</summary>
                    <ul>
                        <li><a href="/workspaces/tickets">Inbox <span class="badge badge-xs badge-primary">10</span></a></li>
                        <li><a href="/workspaces/tickets">Closed</a></li>
                        <li><a href="/workspaces/tickets">test</a></li>
                    </ul>
                </details>
            </li>
            <li><a href="/workspaces/reports"><i class="fa fa-file-alt"></i> Reports</a></li>
            <li><a href="/workspaces/locations"><i class="fa fa-map-marker-alt"></i> Locations</a></li>
            <li><a href="/workspaces/inventory"><i class="fa fa-boxes"></i> Inventory</a></li>
            <li>
                <details open>
                    <summary><i class="fa fa-lock"></i> Security</summary>
                    <ul>
                        <li><a href="/workspaces/users">Users</a></li>
                        <li><a href="/workspaces/roles">Roles</a></li>
                    </ul>
                </details>
            </li>
            <li><a href="/workspaces/settings"><i class="fa fa-cog"></i> Settings</a></li>
        </ul>
        </nav>

        @* List user workspaces with statuses *@
        <div class="mt-6">
            <h3 class="font-bold mb-2">Your Workspaces</h3>
            @if (!Model.Workspaces.Any())
            {
                <p class="text-sm text-muted">No workspaces found for your account.</p>
            }
            else
            {
                <ul class="menu menu-vertical">
                    @foreach (var w in Model.Workspaces)
                    {
                        <li>
                            <a asp-page="/Workspace" asp-route-slug="@w.Slug">@w.Name
                                @if (!w.Accepted)
                                {
                                    <span class="ml-2 text-sm">(pending)</span>
                                }
                            </a>
                        </li>
                    }
                </ul>
            }
        </div>
    </aside>

    <div class="flex-1 overflow-x-auto p-4">
        @* Alert copied from the previous dashboard *@
        <div role="alert" class="alert mb-4">
            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="text-info" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"></path></svg>
            <span>You have not yet confirmed your email address</span>
            <div>
                <form class="inline-block" data-discover="true" action="/email-confirmation/dismiss" method="post">
                    <button type="submit" class="btn btn-sm">Dismiss</button>
                </form>
                <form class="inline-block" data-discover="true ml-2" action="/email-confirmation/resend" method="post">
                    <button type="submit" class="btn btn-sm btn-primary">Resend Email</button>
                </form>
            </div>
        </div>

        @if (Model.Workspace == null)
        {
            <div class="card bg-base-100 shadow-sm p-4">
                <h2 class="text-2xl font-bold">Dashboard</h2>
                <p class="mt-2 text-sm text-muted">TODO: Put a cool dashboard or something here</p>
            </div>
        }
        else
        {
            @if (!Model.IsMember)
            {
                <p>You are not a member of this workspace.</p>
                <p><a href="/workspaces">Back to your workspaces</a></p>
            }
            else
            {
                <h1 class="text-2xl font-bold">@Model.Workspace.Name</h1>
                <p class="mt-2">Workspace slug: @Model.Workspace.Slug</p>
            }
        }
    </div>
</div>
