@page "/workspaces/{slug}/tickets"
@model Tickflo.Web.Pages.Workspaces.TicketsModel
@{
    ViewData["Title"] = "Tickets";
}

<div class="flex flex-row gap-4">
    @await Html.PartialAsync("_WorkspaceSidebar", Model.WorkspaceSlug)
    <section class="relative overflow-hidden p-6 flex-1 space-y-8 text-slate-100 rounded-3xl bg-gradient-to-br from-[#0c1220] via-[#0b101b] to-[#0a0f18]">
@await Html.PartialAsync("_WorkspaceHeader", new Tickflo.Web.Pages.Shared.WorkspaceHeaderView { Slug = Model.WorkspaceSlug, Name = Model.Workspace?.Name ?? "Workspace", SectionTitle = "Tickets", NewActionLabel = "New Ticket", NewActionHref = $"/workspaces/{Model.WorkspaceSlug}/tickets/0", AllowNewAction = Model.CanCreateTickets })

<div class="grid gap-4">
    <div class="flex items-center justify-between">
        <form method="get" class="join md:join">
            <input name="Query" value="@Model.Query" placeholder="Search subject or description" class="input join-item input-sm md:input-md bg-neutral-900/80 border border-white/10 text-slate-100" />
            <select name="Type" class="select join-item select-sm md:select-md bg-neutral-900/80 border border-white/10 text-slate-100">
                <option value="">All Types</option>
                @foreach (var t in Model.TypesList)
                {
                    if (string.Equals(Model.Type, t.Name, StringComparison.OrdinalIgnoreCase))
                    {
                        <option value="@t.Name" selected>@t.Name</option>
                    }
                    else
                    {
                        <option value="@t.Name">@t.Name</option>
                    }
                }
            </select>
            <select name="Status" class="select join-item select-sm md:select-md bg-neutral-900/80 border border-white/10 text-slate-100">
                <option value="">All Statuses</option>
                @foreach (var s in Model.Statuses)
                {
                    if (string.Equals(Model.Status, s.Name, StringComparison.OrdinalIgnoreCase))
                    {
                        <option value="@s.Name" selected>@s.Name</option>
                    }
                    else
                    {
                        <option value="@s.Name">@s.Name</option>
                    }
                }
            </select>
            <select name="Priority" class="select join-item select-sm md:select-md bg-neutral-900/80 border border-white/10 text-slate-100">
                <option value="">All Priorities</option>
                @foreach (var p in Model.PrioritiesList)
                {
                    if (string.Equals(Model.Priority, p.Name, StringComparison.OrdinalIgnoreCase))
                    {
                        <option value="@p.Name" selected>@p.Name</option>
                    }
                    else
                    {
                        <option value="@p.Name">@p.Name</option>
                    }
                }
            </select>
            <select name="AssigneeTeamName" class="select join-item select-sm md:select-md bg-neutral-900/80 border border-white/10 text-slate-100">
                <option value="">Any Team</option>
                @foreach (var kv in Model.TeamsById)
                {
                    if (string.Equals(Model.AssigneeTeamName, kv.Value.Name, StringComparison.OrdinalIgnoreCase))
                    {
                        <option value="@kv.Value.Name" selected>@kv.Value.Name</option>
                    }
                    else
                    {
                        <option value="@kv.Value.Name">@kv.Value.Name</option>
                    }
                }
            </select>
            <select name="LocationId" class="select join-item select-sm md:select-md bg-neutral-900/80 border border-white/10 text-slate-100">
                <option value="">Any Location</option>
                @foreach (var l in Model.LocationOptions)
                {
                    if (Model.LocationId.HasValue && Model.LocationId.Value == l.Id)
                    {
                        <option value="@l.Id" selected>@l.Name</option>
                    }
                    else
                    {
                        <option value="@l.Id">@l.Name</option>
                    }
                }
            </select>
            <input id="contact-query" name="ContactQuery" value="@Model.ContactQuery" placeholder="Contact name or email" class="input join-item input-sm md:input-md bg-neutral-900/80 border border-white/10 text-slate-100" list="contacts-list" />
            <datalist id="contacts-list">
                @foreach (var kv in Model.ContactsById)
                {
                    var c = kv.Value;
                    var label = (c.Email?.Length ?? 0) > 0 ? $"{c.Name} ({c.Email})" : c.Name;
                    <option value="@label"></option>
                }
            </datalist>
            <select name="AssigneeUserId" class="select join-item select-sm md:select-md bg-neutral-900/80 border border-white/10 text-slate-100">
                <option value="">Anyone</option>
                @if (Model.AssigneeUserId == -1) {<option value="-1" selected>Unassigned</option>} else {<option value="-1">Unassigned</option>}
                @foreach (var kv in Model.UsersById)
                {
                    if (Model.AssigneeUserId == kv.Key)
                    {
                        <option value="@kv.Key" selected>@kv.Value.Name (@kv.Value.Email)</option>
                    }
                    else
                    {
                        <option value="@kv.Key">@kv.Value.Name (@kv.Value.Email)</option>
                    }
                }
            </select>
            <label class="label cursor-pointer join-item px-3">
                <span class="label-text mr-2">Mine</span>
                <input type="checkbox" name="Mine" value="true" class="checkbox checkbox-sm" @(Model.Mine ? "checked" : "") />
                <span class="badge badge-soft ml-2 rounded-full">@Model.MyCount</span>
            </label>
            <button class="btn btn-soft join-item btn-sm">Filter</button>
        </form>
    </div>

    <div class="card bg-neutral-900/85 backdrop-blur shadow-2xl rounded-3xl text-slate-100">
      <div class="card-body">
        <div class="overflow-x-auto rounded-2xl bg-neutral-900/70 backdrop-blur">
          <table class="table table-sm table-zebra">
            <thead class="bg-white/5">
                <tr>
                    <th>Subject</th>
                    <th>Type</th>
                    <th>Priority</th>
                    <th>Status</th>
                    <th>Contact</th>
                    <th class="hidden sm:table-cell">Assignee</th>
                    <th class="hidden sm:table-cell">Inventory</th>
                    <th class="hidden md:table-cell">Created</th>
                    <th class="hidden md:table-cell">Location</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                        @foreach (var t in Model.Tickets)
            {
                <tr>
                                        @{
                                            var rowQs = $"Query={Model.Query}&Type={Model.Type}&Status={Model.Status}&Priority={Model.Priority}&ContactQuery={Model.ContactQuery}&Mine={Model.Mine}&AssigneeUserId={Model.AssigneeUserId}&LocationId={Model.LocationId}&PageNumber={Model.PageNumber}&PageSize={Model.PageSize}";
                                        }
                                        <td><a class="link link-hover" href="/workspaces/@Model.WorkspaceSlug/tickets/@t.Id?@rowQs">@t.Subject</a></td>
                    @{
                        var tcolor = Model.TypeColorByName.TryGetValue(t.Type, out var tclr) ? tclr : "neutral";
                        var tIsHex = tcolor.StartsWith("#");
                        var tCls = tIsHex ? "badge badge-soft" : $"badge badge-soft badge-{tcolor}";
                        var tStyle = tIsHex ? $"background-color: {tcolor}; color: #fff;" : null;
                    }
                    <td><span class="@tCls" style="@tStyle">@t.Type</span></td>
                    @{
                        var pcolor = Model.PriorityColorByName.TryGetValue(t.Priority, out var pclr) ? pclr : "neutral";
                        var pIsHex = pcolor.StartsWith("#");
                        var pCls = pIsHex ? "badge badge-soft" : $"badge badge-soft badge-{pcolor}";
                        var pStyle = pIsHex ? $"background-color: {pcolor}; color: #fff;" : null;
                    }
                    <td><span class="@pCls" style="@pStyle">@t.Priority</span></td>
                    @{
                        var color = Model.StatusColorByName.TryGetValue(t.Status, out var col) ? col : "neutral";
                        var isHex = color.StartsWith("#");
                        var statusCls = isHex ? "badge badge-soft" : $"badge badge-soft badge-{color}";
                        var statusStyle = isHex ? $"background-color: {color}; color: #fff;" : null;
                    }
                    <td><span class="@statusCls" style="@statusStyle">@t.Status</span></td>
                        <td>
                        @if (t.ContactId.HasValue && Model.ContactsById.TryGetValue(t.ContactId.Value, out var c))
                        {
                            <span>@c.Name</span>
                            <span class="opacity-60 break-all">(@c.Email)</span>
                        }
                        else
                        {
                                <span class="opacity-60">—</span>
                        }
                    </td>
                        <td class="hidden sm:table-cell">
                        @if (t.AssignedTeamId.HasValue && Model.TeamsById.TryGetValue(t.AssignedTeamId.Value, out var team))
                        {
                            <span class="badge badge-soft rounded-full">@team.Name</span>
                        }
                        else if (t.AssignedUserId.HasValue && Model.UsersById.TryGetValue(t.AssignedUserId.Value, out var au))
                        {
                            <span class="badge badge-soft rounded-full">@au.Name</span>
                            <span class="opacity-60 ml-2">(@au.Email)</span>
                        }
                        else
                        {
                            <span class="badge">Unassigned</span>
                        }
                    </td>
                        <td class="hidden sm:table-cell">
                        @{
                            var invs = t.TicketInventories?.ToList() ?? new List<Tickflo.Core.Entities.TicketInventory>();
                            if (invs.Count > 0)
                            {
                                var count = invs.Count;
                                var total = invs.Sum(iv => iv.UnitPrice * iv.Quantity);
                                var summary = $"{count} item{(count == 1 ? string.Empty : "s")} · ${total:F2}";
                                var tooltip = string.Join(", ", invs.Select(iv => $"{(iv.Inventory?.Name ?? ("SKU " + (iv.Inventory?.Sku ?? iv.InventoryId.ToString())))} x{iv.Quantity}"));
                                <span class="opacity-80" title="@tooltip">@summary</span>
                            }
                            else
                            {
                                <span class="opacity-50">—</span>
                            }
                        }
                    </td>
                        <td class="hidden md:table-cell">@t.CreatedAt.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</td>
                        <td class="hidden md:table-cell">
                            @if (t.LocationId.HasValue && Model.LocationsById.TryGetValue(t.LocationId.Value, out var loc))
                            {
                                <span>@loc.Name</span>
                            }
                            else
                            {
                                <span class="opacity-60">—</span>
                            }
                        </td>
                    <td>
                        <div class="flex flex-wrap gap-2 items-center">
                            @if (Model.CanCreateTickets)
                            {
                                <a class="btn btn-soft btn-sm" href="/workspaces/@Model.WorkspaceSlug/tickets/0@(t.ContactId.HasValue ? ($"?contactId={t.ContactId}") : string.Empty)">Clone</a>
                            }
                            else
                            {
                                <button class="btn btn-soft btn-sm" disabled>Clone</button>
                            }
                            <form method="post" action="/workspaces/@Model.WorkspaceSlug/tickets/@t.Id?@rowQs" class="join ajax-assign" data-ticket-id="@t.Id">
                                <input type="hidden" name="handler" value="Assign" />
                                <input type="hidden" name="slug" value="@Model.WorkspaceSlug" />
                                <input type="hidden" name="id" value="@t.Id" />
                                <input type="hidden" id="assignedUserId-@t.Id" name="assignedUserId" value="@(t.AssignedUserId?.ToString() ?? "")" />
                                <input id="assignee-search-@t.Id" class="input input-bordered join-item input-xs md:input-sm" list="assignees-list-@t.Id" placeholder="Assign" />
                                <datalist id="assignees-list-@t.Id">
                                    <option value="Unassigned" data-id=""></option>
                                    @foreach (var kv in Model.UsersById)
                                    {
                                        <option value="@kv.Value.Name (@kv.Value.Email)" data-id="@kv.Key"></option>
                                    }
                                </datalist>
                                                            <button class="btn btn-soft join-item btn-sm" type="submit" @(Model.CanEditTickets ? "" : "disabled")>Assign</button>
                            </form>
                            <script>
                                (function(){
                                    const hidden = document.getElementById('assignedUserId-@t.Id');
                                    const input = document.getElementById('assignee-search-@t.Id');
                                    const list = document.getElementById('assignees-list-@t.Id');
                                    if (!hidden || !input || !list) return;
                                    function setFromText(){
                                        const val = input.value;
                                        const opts = Array.from(list.querySelectorAll('option'));
                                        const matched = opts.find(o => o.value === val);
                                        if (matched) {
                                            hidden.value = matched.getAttribute('data-id') || '';
                                        } else if (val === '' || val.toLowerCase() === 'unassigned') {
                                            hidden.value = '';
                                        }
                                    }
                                    input.addEventListener('change', setFromText);
                                    input.addEventListener('blur', function(){
                                        setFromText();
                                        if ((hidden.value ?? '') === '' && (input.value === '' || input.value.toLowerCase() === 'unassigned')){
                                            input.value = 'Unassigned';
                                            input.setAttribute('placeholder', 'Pick from list');
                                        }
                                    });
                                    input.addEventListener('focus', function(){
                                        if (input.value.toLowerCase() === 'unassigned') {
                                            input.value = '';
                                        }
                                    });
                                    const preset = hidden.value ?? '';
                                    if (preset !== ''){
                                        const opt = Array.from(list.querySelectorAll('option')).find(o => o.getAttribute('data-id') === preset);
                                        if (opt) input.value = opt.value; else input.value = '';
                                    } else {
                                        input.value = 'Unassigned';
                                    }
                                })();
                            </script>
                        </div>
                    </td>
                </tr>
            }
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="toast" id="assign-toast" style="display:none;">
        <div class="alert alert-success">
            <span id="assign-toast-msg">Assignment updated.</span>
        </div>
    </div>
    <div class="toast" id="assign-error-toast" style="display:none;">
        <div class="alert alert-error">
            <span id="assign-error-toast-msg">Assignment failed.</span>
        </div>
    </div>
    <script>
        (function(){
            @{ var statusDict = new System.Collections.Generic.Dictionary<string, string>();
               foreach (var s in Model.Statuses)
               {
                 var key = s.Name ?? string.Empty;
                 var val = string.IsNullOrWhiteSpace(s.Color) ? "neutral" : s.Color!;
                 statusDict[key] = val;
               }
               var priorityDict = new System.Collections.Generic.Dictionary<string, string>();
               foreach (var p in Model.PrioritiesList)
               {
                 var key = p.Name ?? string.Empty;
                 var val = string.IsNullOrWhiteSpace(p.Color) ? "neutral" : p.Color!;
                 priorityDict[key] = val;
               }
               var typeDict = new System.Collections.Generic.Dictionary<string, string>();
               foreach (var tt in Model.TypesList)
               {
                 var key = tt.Name ?? string.Empty;
                 var val = string.IsNullOrWhiteSpace(tt.Color) ? "neutral" : tt.Color!;
                 typeDict[key] = val;
               }
               var statusJson = System.Text.Json.JsonSerializer.Serialize(statusDict);
               var priorityJson = System.Text.Json.JsonSerializer.Serialize(priorityDict);
               var typeJson = System.Text.Json.JsonSerializer.Serialize(typeDict);
            }
            const statusColors = @Html.Raw(statusJson);
            const priorityColors = @Html.Raw(priorityJson);
            const typeColors = @Html.Raw(typeJson);
            // Minimal fade-in animation style for newly inserted rows
            const style = document.createElement('style');
            style.textContent = ".fade-in { animation: fadeIn 450ms ease-out; }\n@keyframes fadeIn { from { opacity: 0; transform: translateY(-2px); } to { opacity: 1; transform: translateY(0); } }";
            document.head.appendChild(style);
            async function handleAssignSubmit(e){
                e.preventDefault();
                const form = e.currentTarget;
                const ticketId = form.getAttribute('data-ticket-id');
                const input = document.getElementById('assignee-search-' + ticketId);
                const hidden = document.getElementById('assignedUserId-' + ticketId);
                if (!hidden) return;
                const action = form.getAttribute('action');
                const fd = new FormData(form);
                const btn = form.querySelector('button[type="submit"]');
                try {
                    if (btn){ btn.disabled = true; btn.classList.add('btn-disabled'); }
                    const res = await fetch(action, { method: 'POST', body: fd, credentials: 'same-origin' });
                    if (res.ok){
                        const toast = document.getElementById('assign-toast');
                        const msg = document.getElementById('assign-toast-msg');
                        if (toast && msg){
                            const nameTxt = (input && input.value) ? input.value : (hidden.value ? 'Assigned' : 'Unassigned');
                            msg.textContent = `Ticket #${ticketId} assigned: ${nameTxt}`;
                            toast.style.display = '';
                            setTimeout(()=>{ toast.style.display = 'none'; }, 2500);
                        }
                        const badgeCell = form.closest('tr')?.querySelector('td:nth-child(5)');
                        if (badgeCell){
                            if (hidden.value){
                                badgeCell.innerHTML = `<span class="badge badge-soft rounded-full">${input.value}</span>`;
                            } else {
                                badgeCell.innerHTML = `<span class="badge">Unassigned</span>`;
                            }
                        }
                    } else {
                        const toast = document.getElementById('assign-error-toast');
                        const msg = document.getElementById('assign-error-toast-msg');
                        if (toast && msg){
                            msg.textContent = `Assign failed (status ${res.status}).`;
                            toast.style.display = '';
                            setTimeout(()=>{ toast.style.display = 'none'; }, 3000);
                        }
                        console.error('Assign failed', res.status);
                    }
                } catch(err){
                    const toast = document.getElementById('assign-error-toast');
                    const msg = document.getElementById('assign-error-toast-msg');
                    if (toast && msg){
                        msg.textContent = 'Assign error. Please try again.';
                        toast.style.display = '';
                        setTimeout(()=>{ toast.style.display = 'none'; }, 3000);
                    }
                    console.error('Assign error', err);
                } finally {
                    if (btn){ btn.disabled = false; btn.classList.remove('btn-disabled'); }
                }
            }
            document.querySelectorAll('form.ajax-assign').forEach(f => {
                f.addEventListener('submit', handleAssignSubmit);
            });
            // Live updates: connect SignalR and join workspace group
            const slug = '@Model.WorkspaceSlug';
            try {
                const connection = new signalR.HubConnectionBuilder()
                    .withUrl('/hubs/tickets')
                    .withAutomaticReconnect()
                    .build();
                connection.on('ticketCreated', function(t){
                    // Prepend a new row for the created ticket
                    const tbody = document.querySelector('table tbody');
                    if (!tbody) return;
                    const contactDisplay = t.contactDisplay || (t.contactId ?? '—');
                    const created = new Date(t.createdAt).toLocaleString();
                                        const tr = document.createElement('tr');
                                        tr.classList.add('fade-in');
                    const rowQs = `Query=@Model.Query&Status=@Model.Status&Priority=@Model.Priority&ContactQuery=@Model.ContactQuery&Mine=@Model.Mine&AssigneeUserId=@Model.AssigneeUserId&PageNumber=@Model.PageNumber&PageSize=@Model.PageSize`;
                                        const color = statusColors[t.status] || 'neutral';
                                        const isHex = (typeof color === 'string') && color.startsWith('#');
                                        const statusSpan = isHex
                                                ? `<span class="badge" style="background-color: ${color}; color: #fff;">${t.status}</span>`
                                                : `<span class="badge badge-soft badge-${color} rounded-full">${t.status}</span>`;
                    tr.innerHTML = `
                        <td><a class="link link-hover" href="/workspaces/${slug}/tickets/${t.id}?${rowQs}">${t.subject}</a></td>
                        ${(() => { const tc = typeColors[t.type] || 'neutral'; const tIsHex = (typeof tc === 'string') && tc.startsWith('#'); return tIsHex ? `<td><span class=\"badge badge-soft\" style=\"background-color: ${tc}; color: #fff;\">${t.type}</span></td>` : `<td><span class=\"badge badge-soft badge-${tc}\">${t.type}</span></td>`; })()}
                        {
                            const pc = priorityColors[t.priority] || 'neutral';
                            const pIsHex = (typeof pc === 'string') && pc.startsWith('#');
                            const prioSpan = pIsHex
                                ? `<span class="badge badge-soft rounded-full" style="background-color: ${pc}; color: #fff;">${t.priority}</span>`
                                : `<span class="badge badge-soft badge-${pc} rounded-full">${t.priority}</span>`;
                            }
                        <td>${prioSpan}</td>
                                                <td>${statusSpan}</td>
                        <td><span>${contactDisplay}</span></td>
                        <td class="hidden sm:table-cell"><span class="badge ${t.assignedUserId ? 'badge-soft' : ''} rounded-full">${t.assignedUserId ? (t.assignedDisplay || 'Assigned') : 'Unassigned'}</span></td>
                            <td class="hidden sm:table-cell"><span class="opacity-80" title="${t.inventoryDetails || ''}">${t.inventorySummary || '—'}</span></td>
                        <td class="hidden md:table-cell">${created}</td>
                        <td>
                          <div class="flex flex-wrap gap-2 items-center">
                            <a class="btn btn-soft btn-sm" href="/workspaces/${slug}/tickets/0?contactId=${t.contactId}">Clone</a>
                            <!-- Inline assign form omitted for live-created rows; user can open details page -->
                          </div>
                        </td>`;
                    tbody.insertBefore(tr, tbody.firstChild);
                });
                // Update existing row when a ticket is edited
                connection.on('ticketUpdated', function(t){
                    const row = document.querySelector(`tr td a[href^="/workspaces/${slug}/tickets/${t.id}"]`)?.closest('tr');
                    if (row){
                        const subjectCell = row.querySelector('td:nth-child(1) a');
                        const typeCell = row.querySelector('td:nth-child(2) .badge');
                        const prioCell = row.querySelector('td:nth-child(3) .badge');
                        const statusCell = row.querySelector('td:nth-child(4) .badge');
                        if (typeCell){
                            typeCell.textContent = t.type;
                            const tc = typeColors[t.type] || 'neutral';
                            if ((typeof tc === 'string') && tc.startsWith('#')){
                                typeCell.className = 'badge badge-soft';
                                typeCell.setAttribute('style', `background-color: ${tc}; color: #fff;`);
                            } else {
                                typeCell.className = `badge badge-soft badge-${tc}`;
                                typeCell.removeAttribute('style');
                            }
                        }
                        if (subjectCell) subjectCell.textContent = t.subject;
                        if (prioCell) {
                            prioCell.textContent = t.priority;
                            const pc = priorityColors[t.priority] || 'neutral';
                            if ((typeof pc === 'string') && pc.startsWith('#')){
                                prioCell.className = 'badge badge-soft';
                                prioCell.setAttribute('style', `background-color: ${pc}; color: #fff;`);
                            } else {
                                prioCell.className = `badge badge-soft badge-${pc}`;
                                prioCell.removeAttribute('style');
                            }
                        }
                        if (statusCell) {
                            statusCell.textContent = t.status;
                            const c = statusColors[t.status] || 'neutral';
                            if ((typeof c === 'string') && c.startsWith('#')) {
                                statusCell.className = 'badge';
                                statusCell.setAttribute('style', `background-color: ${c}; color: #fff;`);
                            } else {
                                statusCell.className = `badge badge-soft badge-${c}`;
                                statusCell.removeAttribute('style');
                            }
                        }
                        const invCell = row.querySelector('td:nth-child(7)');
                        if (invCell){
                               invCell.innerHTML = `<span class="opacity-80" title="${t.inventoryDetails || ''}">${t.inventorySummary || '—'}</span>`;
                        }
                    }
                });
                connection.on('ticketAssigned', function(t){
                    const row = document.querySelector(`tr td a[href^="/workspaces/${slug}/tickets/${t.id}"]`)?.closest('tr');
                    if (!row) return;
                    const assigneeCell = row.querySelector('td:nth-child(5)');
                    if (!assigneeCell) return;
                    if (t.assignedUserId){
                        const label = t.assignedDisplay || 'Assigned';
                        assigneeCell.innerHTML = `<span class="badge badge-soft rounded-full">${label}</span>`;
                    } else {
                        assigneeCell.innerHTML = `<span class="badge">Unassigned</span>`;
                    }
                });
                await connection.start();
                await connection.invoke('JoinWorkspace', slug);
            } catch (err) {
                console.warn('SignalR connection failed', err);
            }
        })();
    </script>

    <div class="flex justify-between items-center">
        <div class="text-sm opacity-70">Showing page @Model.PageNumber of @((Model.Total + Model.PageSize - 1)/Model.PageSize) · @Model.Total total</div>
        <div class="join">
            @{
                var prev = Model.PageNumber > 1 ? Model.PageNumber - 1 : 1;
                var next = (Model.PageNumber * Model.PageSize) < Model.Total ? Model.PageNumber + 1 : Model.PageNumber;
                var baseQs = $"Query={Model.Query}&Type={Model.Type}&Status={Model.Status}&Priority={Model.Priority}&ContactQuery={Model.ContactQuery}&Mine={Model.Mine}&AssigneeUserId={Model.AssigneeUserId}&LocationId={Model.LocationId}&PageSize={Model.PageSize}";
            }
            <a class="btn btn-soft join-item btn-sm @(Model.PageNumber <= 1 ? "btn-disabled" : "")" href="?@baseQs&PageNumber=@prev">Prev</a>
            <a class="btn btn-soft join-item btn-sm @(((Model.PageNumber * Model.PageSize) >= Model.Total) ? "btn-disabled" : "")" href="?@baseQs&PageNumber=@next">Next</a>
        </div>
    </div>
    </div>
    </section>
</div>
