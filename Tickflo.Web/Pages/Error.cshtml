@page
@model ErrorModel
@{
    ViewData["Title"] = "Error";
}

<style>
    /* Custom animations for error page */
    @@keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .card {
        animation: slideIn 0.4s ease-out;
    }
</style>

<div class="flex">
    @await Html.PartialAsync("_AppSidebar")
    <section class="p-6 flex-1">
        <div class="w-full max-w-4xl">
            <!-- Error Header -->
            <div class="card bg-gradient-to-br from-error/10 to-error/5 border border-error/20 shadow-sm rounded-3xl overflow-hidden">
                <div class="card-body">
                    <div class="flex items-start gap-4">
                        <div class="text-4xl">
                            <i class="fas fa-circle-exclamation text-error"></i>
                        </div>
                        <div class="flex-1">
                            <h1 class="card-title text-2xl mb-2">Something went wrong</h1>
                            <p class="text-base-content/70">
                                An unexpected error occurred while processing your request. We've logged this incident and our team has been notified.
                            </p>
                        </div>
                    </div>

                    <!-- Request ID - Always visible -->
                    @if (Model.ShowRequestId)
                    {
                        <div class="mt-4 pt-4 border-t border-base-content/10">
                            <div class="flex items-center gap-2">
                                <span class="text-sm font-semibold text-base-content/70">Reference ID:</span>
                                <code class="badge badge-primary bg-primary/20 text-primary border-0 font-mono text-xs">@Model.RequestId</code>
                                <button class="btn btn-xs btn-ghost" onclick="navigator.clipboard.writeText('@Model.RequestId').then(() => alert('Copied!'))">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <p class="text-xs text-base-content/50 mt-2">Share this ID with support if you need help</p>
                        </div>
                    }
                </div>
            </div>

            <!-- Admin Error Details Section -->
            @if (Model.IsAdmin)
            {
                <div class="card bg-base-200/50 border border-warning/30 shadow-sm rounded-3xl mt-6">
                    <div class="card-body">
                        <div class="flex items-center gap-2 mb-4">
                            <i class="fas fa-shield-halved text-warning"></i>
                            <h2 class="card-title text-lg">Admin Error Details</h2>
                        </div>
                        
                        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                        {
                            <div class="mt-3">
                                <label class="text-sm font-semibold text-base-content/70 block mb-1">Error Message</label>
                                <div class="bg-base-100 p-3 rounded-xl border border-base-content/10 font-mono text-sm break-words">
                                    @Model.ErrorMessage
                                </div>
                            </div>
                        }

                        @if (Model.StatusCode.HasValue)
                        {
                            <div class="mt-3">
                                <label class="text-sm font-semibold text-base-content/70 block mb-1">HTTP Status Code</label>
                                <div class="badge badge-lg badge-warning text-warning-content">@Model.StatusCode</div>
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(Model.ExceptionDetails))
                        {
                            <div class="mt-4 pt-4 border-t border-base-content/10">
                                <details class="collapse collapse-arrow bg-base-100 rounded-xl border border-base-content/10">
                                    <summary class="collapse-title font-semibold text-sm text-base-content/70">
                                        <i class="fas fa-code mr-2"></i>Stack Trace
                                    </summary>
                                    <div class="collapse-content">
                                        <div class="bg-black/50 p-4 rounded-lg mt-2 overflow-x-auto max-h-96">
                                            <code class="text-xs text-success font-mono">
                                                @Html.Raw(Model.ExceptionDetails)
                                            </code>
                                        </div>
                                    </div>
                                </details>
                            </div>
                        }

                        <div class="mt-4 p-3 bg-warning/10 border border-warning/30 rounded-xl text-xs text-warning-content">
                            <i class="fas fa-triangle-exclamation mr-1"></i>
                            <strong>Note:</strong> This detailed error information is only visible to system administrators. Regular users see a generic message.
                        </div>
                    </div>
                </div>
            }

            <!-- Generic User Message -->
            @if (!Model.IsAdmin)
            {
                <div class="card bg-base-100 shadow-sm rounded-3xl mt-6">
                    <div class="card-body">
                        <h2 class="card-title text-lg">What can you do?</h2>
                        <ul class="list-disc list-inside space-y-2 text-base-content/70 mt-3">
                            <li>Check your internet connection</li>
                            <li>Try refreshing the page</li>
                            <li>Clear your browser cache</li>
                            <li>Come back in a few moments to try again</li>
                        </ul>
                        <p class="text-sm text-base-content/50 mt-4">
                            If the problem persists, please contact our support team and reference the ID above.
                        </p>
                    </div>
                </div>
            }

            <!-- Action Buttons -->
            <div class="join mt-6 flex gap-3">
                <a class="btn btn-primary rounded-full" href="/">
                    <i class="fas fa-home"></i>
                    Back to Home
                </a>
                @if (Model.ShowRequestId)
                {
                    <button class="btn btn-outline rounded-full" onclick="history.back()">
                        <i class="fas fa-arrow-left"></i>
                        Go Back
                    </button>
                }
            </div>
        </div>
    </section>
</div>
